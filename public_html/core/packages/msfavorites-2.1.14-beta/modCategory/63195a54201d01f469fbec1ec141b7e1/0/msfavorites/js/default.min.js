!function(t,s){"use strict";var e,i,a,o=[].indexOf||function(t){for(var s=0,e=this.length;s<e;s++)if(s in this&&this[s]===t)return s;return-1},n=[].slice,r=function(t,s){return function(){return t.apply(s,arguments)}},l=function(t){return t.replace(/(-|\.)(\w)/g,function(t,s){return s.toUpperCase()})},f=function(s,e,i){var a,o;if(void 0===e&&(e=t.fn.msfavorites.defaults.ns),a=l(e),o=s.data("msFavorites"),t.each(i,function(t,e){s.data(a+"-"+t,e)}),o)switch(a){case"data":o.data=t.extend(!0,o.data,i);break;case"options":o.options=t.extend(!0,o.options,i)}return i},c=function(s,e){var i,a;return void 0===e&&(e=t.fn.msfavorites.defaults.ns),i=l(e),a=s.data(i)||{},t.each(s.data(),function(t,s){if(0===t.indexOf(i)){var e=t.replace(i,"").replace(/[A-Z]/g,function(t,s){return(0==s?"":"-")+t.toLowerCase()});e.length>0&&(a[e]=s)}}),a},d=function(t,s){if("function"==typeof t)return t.apply(s,Array.prototype.slice.call(arguments,2));if("object"==typeof t)for(var e in t){if(t.hasOwnProperty(e))if(!1===t[e].apply(s,Array.prototype.slice.call(arguments,2)))return!1}return!0};e=["extended","included"],function(){function t(){}t.extend=function(t){var s,i,a;for(s in t)a=t[s],o.call(e,s)<0&&(this[s]=a);return null!=(i=t.extended)&&i.apply(this),this},t.include=function(t){var s,i,a;for(s in t)a=t[s],o.call(e,s)<0&&(this.prototype[s]=a);return null!=(i=t.included)&&i.apply(this),this}}(),(i=function(e,i){this.defaults=t.fn.msfavorites.defaults,this.selectors=t.fn.msfavorites.selectors,this.$body=t("body"),this.$element=t(e),this.$parent=this.$element.closest(this.selectors.parent),this.$parent.length<1&&(this.$parent=t("body")),this.options=t.extend(!0,{},c(this.$parent),i),this.data=t.extend(!0,{id:0,ctx:s.ctx},c(this.$parent,"data"),c(this.$element,"data")),this.list=this.$body.data("msFavoritesList"),this.list||(this.setFavoritesList({}),this.getFavoritesList()),this.updateFavorites()}).prototype={constructor:i,init:function(){this.processSuccess=r(this.processSuccess,this),this.processFailure=r(this.processFailure,this),this.processAction=r(this.processAction,this),this.getFavoritesList=r(this.getFavoritesList,this),this.setFavoritesList=r(this.setFavoritesList,this),this.addMethodAction=r(this.addMethodAction,this),this.removeMethodAction=r(this.removeMethodAction,this)},getFavoritesList:function(){var e,i,a;e=t.extend(!0,this.data,{action:"favorites/multiple",limit:0,options:this.options}),t.ajax({url:s.actionUrl,type:"get",dataType:"json",cache:!1,data:e}).done((a=this,function(t){a.processSuccess(t),a.setFavoritesList(t.data),a.updateFavorites(t.data)})).fail((i=this,function(t){i.processFailure(t)}))},setFavoritesList:function(t){this.$body.data("msFavoritesList",t||{})},updateFavorites:function(s,e,i){var a,o,n,r,l,f,c;switch(s||(s=this.$body.data("msFavoritesList")),l=this.$parent.parent(),a=t(t.fn.msfavorites.selectors.main),o=t(t.fn.msfavorites.selectors.total),n=t(t.fn.msfavorites.selectors.totalAll),r=t(t.fn.msfavorites.selectors.totalUser),e&&i&&(r=r.filter('[data-data-id="'+i.id+'"]')),"object"==typeof s.list&&t.each(a.not(this.defaults.cls.load),(f=this,function(){var e,i,a;i=(e=t(this)).data("data-list"),a=e.data("data-id"),s.list[i]&&t.inArray(a,s.list[i])>-1?e.addClass(f.defaults.cls.load).addClass(f.defaults.cls.voted):t.inArray(a,s.list[i])<0&&e.addClass(f.defaults.cls.load).removeClass(f.defaults.cls.voted)})),"object"==typeof s.total&&t.each(o,function(){var e,i,a;i=(e=t(this)).data("data-list"),a=parseInt(s.total[i]||0),setTimeout(function(){e.text(a),e.attr("data-value",a)},200)}),"object"==typeof s.total&&t.each(n,(c=this,function(){var e,i,a;i=(e=t(this)).data("data-list"),a=parseInt(s.total[i]||0),e.hasClass(c.defaults.cls.visible)||(a?e.show():e.hide())})),"object"==typeof s.user&&t.each(r,function(){var e,i,a,o,n;i=(e=t(this)).data("data-list"),a=e.data("data-id"),n=s.user[i]||{},o=parseInt(n[a]||0),setTimeout(function(){e.text(o),e.attr("data-value",o)},200)}),!0){case"list"==this.options.mode&&"remove"==e:this.$parent.remove(),l.find(this.selectors.parent).length<1&&location.reload();break;case"clear"==e:var d;(d=this.$element.data("data-list"))&&s.list&&!s.list[d]&&(this.$parent.remove(),location.reload())}a.not(this.defaults.cls.load).addClass(this.defaults.cls.load)},processAction:function(){var e,i,a,o,n;(i=this.$element.hasClass(this.defaults.cls.action)?this.data.method:this.$element.hasClass(this.defaults.cls.voted)?"remove":"add",a=t.extend(!0,this.data,{action:"favorites/multiple",method:i}),e=t.Event(t.fn.msfavorites.PROCESS_ACTION),this.$element.trigger(e,a),e.isDefaultPrevented())||(this.$element.removeClass(this.defaults.cls.load).removeClass(this.defaults.cls.voted),t.ajax({url:s.actionUrl,type:"post",dataType:"json",cache:!1,data:a}).done((n=this,function(t){n.processSuccess(t),n.setFavoritesList(t.data),n.updateFavorites(t.data,i,a)})).fail((o=this,function(t){o.processFailure(t)})))},processSuccess:function(s){var e,i;if(e=t.Event(t.fn.msfavorites.PROCESS_SUCCESS),this.$element.trigger(e,s),!e.isDefaultPrevented())return s.success||((i=s.message)||(i="error unknown"),console.log(i)),d(t.fn.msfavorites.methodActions.success,this,s),!0},processFailure:function(s){var e,i;if(e=t.Event(t.fn.msfavorites.PROCESS_FAILURE),this.$element.trigger(e,s),!e.isDefaultPrevented())return(i=s.responseJSON)||(i="error unknown"),console.log(i),d(t.fn.msfavorites.methodActions.failure,this,s.responseJSON),!1},addMethodAction:function(s,e,i){return"function"==typeof i&&(t.fn.msfavorites.methodActions[s]||(t.fn.msfavorites.methodActions[s]={}),t.fn.msfavorites.methodActions[s][e]=i,!0)},removeMethodAction:function(s,e){return t.fn.msfavorites.methodActions[s]||(t.fn.msfavorites.methodActions[s]={}),delete t.fn.msfavorites.methodActions[s][e],!0}},t.fn.msfavorites=function(){var s,e;return e=arguments[0],s=2<=arguments.length?n.call(arguments,1):[],this.each(function(){var a,o,n,r;if((n=(a=t(this)).data("msFavorites"))||((o=a.closest(t.fn.msfavorites.selectors.parent)).length<1&&(o=t("body")),(r=t.extend(!0,{},c(o),c(a))).mode,(n=new i(this,r))&&(a.data("msFavorites",n),n.init())),"string"==typeof e)return n[e].apply(n,s)})},t.fn.msfavorites.CONTENT_CHANGE="msfavorites:content-change.msfavorites",t.fn.msfavorites.PROCESS_SUCCESS="msfavorites:process-success.msfavorites",t.fn.msfavorites.PROCESS_FAILURE="msfavorites:process-failure.msfavorites",t.fn.msfavorites.PROCESS_ACTION="msfavorites:process-action.msfavorites",t.fn.msfavorites.defaults={ns:"msfavorites",cls:{load:"load",voted:"voted",visible:"visible",action:"msfavorites-action"},timeout:300},t.fn.msfavorites.selectors={main:"."+t.fn.msfavorites.defaults.ns,total:"."+t.fn.msfavorites.defaults.ns+"-total",totalAll:"."+t.fn.msfavorites.defaults.ns+"-total-all",totalUser:"."+t.fn.msfavorites.defaults.ns+"-total-user",parent:"."+t.fn.msfavorites.defaults.ns+"-parent",actionClick:"[data-click]",actionFormSubmit:"[data-formsubmit]",actionFormChange:"[data-formchange]"},t.fn.msfavorites.methodActions={success:{},failure:{"set.cls.load":function(t){this.$element&&this.defaults.cls&&this.$element.addClass(this.defaults.cls.load)},"miniShop2.Message.initialize":function(t){"object"==typeof miniShop2&&(miniShop2.Message.initialize(),t&&t.message&&miniShop2.Message.error(t.message))}}},a=jQuery,jQuery.fn.originalHtml=jQuery.fn.html,jQuery.fn.html=function(){var t=this.originalHtml();return arguments.length&&jQuery.fn.originalHtml?(jQuery.fn.originalHtml.apply(this,arguments),this.trigger(a.fn.msfavorites.CONTENT_CHANGE,jQuery.merge([t],arguments)),this):t},t(document).on("click",t.fn.msfavorites.selectors.main+t.fn.msfavorites.selectors.actionClick,function(s){var e=t(this);if(e.is("a")&&s.preventDefault(),e.is("form")){var i={};t.map(e.serializeArray()||[],function(t,s){i[t.name]=t.value}),f(e,"data",i)}e.msfavorites("processAction")}),t(document).on("submit",t.fn.msfavorites.selectors.main+t.fn.msfavorites.selectors.actionFormSubmit,function(s){var e=t(this),i={};s.preventDefault(),t.map(e.serializeArray()||[],function(t,s){i[t.name]=t.value}),f(e,"data",i),e.msfavorites("processAction")}),t(document).on("change",t.fn.msfavorites.selectors.main+t.fn.msfavorites.selectors.actionFormChange,function(s){var e=t(this),i={};s.preventDefault(),t.map(e.serializeArray()||[],function(t,s){i[t.name]=t.value}),f(e,"data",i),e.msfavorites("processAction")}),t(document).on(t.fn.msfavorites.CONTENT_CHANGE,function(){t(t.fn.msfavorites.selectors.main).msfavorites()}),t(window).on("load",function(){t(t.fn.msfavorites.selectors.main).msfavorites()}),window.msFavorites=new i(null,s.options)}(window.jQuery,msFavoritesConfig);