!function(d,o){"use strict";var a,n,s,r=[].indexOf||function(t){for(var s=0,e=this.length;s<e;s++)if(s in this&&this[s]===t)return s;return-1},t=[].slice,e=function(t,s){return function(){return t.apply(s,arguments)}},l=function(t){return t.replace(/(-|\.)(\w)/g,function(t,s){return s.toUpperCase()})},i=function(e,t,s){var i,a;if(void 0===t&&(t=d.fn.msfavorites.defaults.ns),i=l(t),a=e.data("msFavorites"),d.each(s,function(t,s){e.data(i+"-"+t,s)}),a)switch(i){case"data":a.data=d.extend(!0,a.data,s);break;case"options":a.options=d.extend(!0,a.options,s)}return s},f=function(t,s){var i,a;return void 0===s&&(s=d.fn.msfavorites.defaults.ns),i=l(s),a=t.data(i)||{},d.each(t.data(),function(t,s){if(0===t.indexOf(i)){var e=t.replace(i,"").replace(/[A-Z]/g,function(t,s){return(0==s?"":"-")+t.toLowerCase()});0<e.length&&(a[e]=s)}}),a},c=function(t,s){if("function"==typeof t)return t.apply(s,Array.prototype.slice.call(arguments,2));if("object"==typeof t)for(var e in t){if(t.hasOwnProperty(e))if(!1===t[e].apply(s,Array.prototype.slice.call(arguments,2)))return!1}return!0};a=["extended","included"],function(){function t(){}t.extend=function(t){var s,e,i;for(s in t)i=t[s],r.call(a,s)<0&&(this[s]=i);return null!=(e=t.extended)&&e.apply(this),this},t.include=function(t){var s,e,i;for(s in t)i=t[s],r.call(a,s)<0&&(this.prototype[s]=i);return null!=(e=t.included)&&e.apply(this),this}}(),(n=function(t,s){this.defaults=d.fn.msfavorites.defaults,this.selectors=d.fn.msfavorites.selectors,this.$body=d("body"),this.$element=d(t),this.$parent=this.$element.closest(this.selectors.parent),this.$parent.length<1&&(this.$parent=d("body")),this.options=d.extend(!0,{},f(this.$parent),s),this.data=d.extend(!0,{id:0,ctx:o.ctx},f(this.$parent,"data"),f(this.$element,"data")),this.list=this.$body.data("msFavoritesList"),this.list||(this.setFavoritesList({}),this.getFavoritesList()),this.updateFavorites()}).prototype={constructor:n,init:function(){this.processSuccess=e(this.processSuccess,this),this.processFailure=e(this.processFailure,this),this.processAction=e(this.processAction,this),this.getFavoritesList=e(this.getFavoritesList,this),this.setFavoritesList=e(this.setFavoritesList,this),this.addMethodAction=e(this.addMethodAction,this),this.removeMethodAction=e(this.removeMethodAction,this)},getFavoritesList:function(){var t,s,e;t=d.extend(!0,this.data,{action:"favorites/multiple",limit:0,options:this.options}),d.ajax({url:o.actionUrl,type:"get",dataType:"json",cache:!1,data:t}).done((e=this,function(t){e.processSuccess(t),e.setFavoritesList(t.data),e.updateFavorites(t.data)})).fail((s=this,function(t){s.processFailure(t)}))},setFavoritesList:function(t){this.$body.data("msFavoritesList",t||{})},updateFavorites:function(o,t,s){var e,i,a,n,r,l,f;switch(o||(o=this.$body.data("msFavoritesList")),r=this.$parent.parent(),e=d(d.fn.msfavorites.selectors.main),i=d(d.fn.msfavorites.selectors.total),a=d(d.fn.msfavorites.selectors.totalAll),n=d(d.fn.msfavorites.selectors.totalUser),t&&s&&(n=n.filter('[data-data-id="'+s.id+'"]')),"object"==typeof o.list&&d.each(e.not(this.defaults.cls.load),(l=this,function(){var t,s,e;s=(t=d(this)).data("data-list"),e=t.data("data-id"),o.list[s]&&-1<d.inArray(e,o.list[s])?t.addClass(l.defaults.cls.load).addClass(l.defaults.cls.voted):d.inArray(e,o.list[s])<0&&t.addClass(l.defaults.cls.load).removeClass(l.defaults.cls.voted)})),"object"==typeof o.total&&d.each(i,function(){var t,s,e;s=(t=d(this)).data("data-list"),e=parseInt(o.total[s]||0),setTimeout(function(){t.text(e),t.attr("data-value",e)},200)}),"object"==typeof o.total&&d.each(a,(f=this,function(){var t,s,e;s=(t=d(this)).data("data-list"),e=parseInt(o.total[s]||0),t.hasClass(f.defaults.cls.visible)||(e?t.show():t.hide())})),"object"==typeof o.user&&d.each(n,function(){var t,s,e,i,a;s=(t=d(this)).data("data-list"),e=t.data("data-id"),a=o.user[s]||{},i=parseInt(a[e]||0),setTimeout(function(){t.text(i),t.attr("data-value",i)},200)}),!0){case"list"==this.options.mode&&"remove"==t:this.$parent.remove(),r.find(this.selectors.parent).length<1&&location.reload();break;case"clear"==t:var c;(c=this.$element.data("data-list"))&&o.list&&!o.list[c]&&(this.$parent.remove(),location.reload())}e.not(this.defaults.cls.load).addClass(this.defaults.cls.load)},processAction:function(){var t,s,e,i,a;(s=this.$element.hasClass(this.defaults.cls.action)?this.data.method:this.$element.hasClass(this.defaults.cls.voted)?"remove":"add",e=d.extend(!0,this.data,{action:"favorites/multiple",method:s}),t=d.Event(d.fn.msfavorites.PROCESS_ACTION),this.$element.trigger(t,e),t.isDefaultPrevented())||(this.$element.removeClass(this.defaults.cls.load).removeClass(this.defaults.cls.voted),d.ajax({url:o.actionUrl,type:"post",dataType:"json",cache:!1,data:e}).done((a=this,function(t){a.processSuccess(t),a.setFavoritesList(t.data),a.updateFavorites(t.data,s,e)})).fail((i=this,function(t){i.processFailure(t)})))},processSuccess:function(t){var s,e;if(s=d.Event(d.fn.msfavorites.PROCESS_SUCCESS),this.$element.trigger(s,t),!s.isDefaultPrevented())return t.success||((e=t.message)||(e="error unknown"),console.log(e)),c(d.fn.msfavorites.methodActions.success,this,t),!0},processFailure:function(t){var s,e;if(s=d.Event(d.fn.msfavorites.PROCESS_FAILURE),this.$element.trigger(s,t),!s.isDefaultPrevented())return(e=t.responseJSON)||(e="error unknown"),console.log(e),c(d.fn.msfavorites.methodActions.failure,this,t.responseJSON),!1},addMethodAction:function(t,s,e){return"function"==typeof e&&(d.fn.msfavorites.methodActions[t]||(d.fn.msfavorites.methodActions[t]={}),d.fn.msfavorites.methodActions[t][s]=e,!0)},removeMethodAction:function(t,s){return d.fn.msfavorites.methodActions[t]||(d.fn.msfavorites.methodActions[t]={}),delete d.fn.msfavorites.methodActions[t][s],!0}},d.fn.msfavorites=function(){var a,o;return o=arguments[0],a=2<=arguments.length?t.call(arguments,1):[],this.each(function(){var t,s,e,i;if((e=(t=d(this)).data("msFavorites"))||((s=t.closest(d.fn.msfavorites.selectors.parent)).length<1&&(s=d("body")),(i=d.extend(!0,{},f(s),f(t))).mode,(e=new n(this,i))&&(t.data("msFavorites",e),e.init())),"string"==typeof o)return e[o].apply(e,a)})},d.fn.msfavorites.CONTENT_CHANGE="msfavorites:content-change.msfavorites",d.fn.msfavorites.PROCESS_SUCCESS="msfavorites:process-success.msfavorites",d.fn.msfavorites.PROCESS_FAILURE="msfavorites:process-failure.msfavorites",d.fn.msfavorites.PROCESS_ACTION="msfavorites:process-action.msfavorites",d.fn.msfavorites.defaults={ns:"msfavorites",cls:{load:"load",voted:"voted",visible:"visible",action:"msfavorites-action",animation:"msfavorites-animation"},timeout:300},d.fn.msfavorites.selectors={main:"."+d.fn.msfavorites.defaults.ns,total:"."+d.fn.msfavorites.defaults.ns+"-total",totalAll:"."+d.fn.msfavorites.defaults.ns+"-total-all",totalUser:"."+d.fn.msfavorites.defaults.ns+"-total-user",parent:"."+d.fn.msfavorites.defaults.ns+"-parent",actionClick:"[data-click]",actionFormSubmit:"[data-formsubmit]",actionFormChange:"[data-formchange]"},d.fn.msfavorites.methodActions={success:{animation:function(t){var s;if(this.data&&this.data.method&&"add"===this.data.method&&(this.options&&this.options.animation&&(s=d(d.fn.msfavorites.selectors.totalAll).filter("[data-msfavorites-animation]").filter('[data-data-list="'+this.data.list+'"]'))&&s.length)){var e={start:this.$element.offset(),end:s.offset()};d("<img/>",{src:this.options.animation,class:this.defaults.cls.animation}).css({position:"absolute","z-index":"9999","background-size":"cover",top:e.start.top||0,left:e.start.left||0}).appendTo("body").animate({top:e.end.top||0,left:e.end.left||0,opacity:"toggle"},1e3,function(){d(this).remove()})}}},failure:{"set.cls.load":function(t){this.$element&&this.defaults.cls&&this.$element.addClass(this.defaults.cls.load)},"miniShop2.Message.initialize":function(t){"object"==typeof miniShop2&&(miniShop2.Message.initialize(),t&&t.message&&miniShop2.Message.error(t.message))}}},s=jQuery,jQuery.fn.originalHtml=jQuery.fn.html,jQuery.fn.html=function(){var t=this.originalHtml();return arguments.length&&jQuery.fn.originalHtml?(jQuery.fn.originalHtml.apply(this,arguments),this.trigger(s.fn.msfavorites.CONTENT_CHANGE,jQuery.merge([t],arguments)),this):t},d(document).on("click",d.fn.msfavorites.selectors.main+d.fn.msfavorites.selectors.actionClick,function(t){var s=d(this);if(s.is("a")&&t.preventDefault(),s.is("form")){var e={};d.map(s.serializeArray()||[],function(t,s){e[t.name]=t.value}),i(s,"data",e)}s.msfavorites("processAction")}),d(document).on("submit",d.fn.msfavorites.selectors.main+d.fn.msfavorites.selectors.actionFormSubmit,function(t){var s=d(this),e={};t.preventDefault(),d.map(s.serializeArray()||[],function(t,s){e[t.name]=t.value}),i(s,"data",e),s.msfavorites("processAction")}),d(document).on("change",d.fn.msfavorites.selectors.main+d.fn.msfavorites.selectors.actionFormChange,function(t){var s=d(this),e={};t.preventDefault(),d.map(s.serializeArray()||[],function(t,s){e[t.name]=t.value}),i(s,"data",e),s.msfavorites("processAction")}),d(document).on(d.fn.msfavorites.CONTENT_CHANGE,function(){d(d.fn.msfavorites.selectors.main).msfavorites()}),d(window).on("load",function(){d(d.fn.msfavorites.selectors.main).msfavorites()}),window.msFavorites=new n(null,o.options)}(window.jQuery,msFavoritesConfig);